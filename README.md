## Fan Xu Complex SQL Query for a MySQL Database

[![CI](https://github.com/nogibjj/fan_xu_sql_db/actions/workflows/cicd.yml/badge.svg)](https://github.com/nogibjj/fan_xu_sql_db/actions/workflows/cicd.yml)

This project is for practicing interacting with an external Database using a python script, in this case DataBricks. After connecting to the database, a complex SQL query involving joins, aggregation, and sorting is run. 

### Requirements:

- Design a complex SQL query involving joins, aggregation, and sorting
- Provide an explanation for what the query is doing and the expected results

### Project Structure

```
ðŸ“¦ fan_xu_sql_assn
â”œâ”€Â .devcontainer
â”‚Â Â â”œâ”€Â Dockerfile
â”‚Â Â â””â”€Â devcontainer.json
â”œâ”€Â .github
â”‚Â Â â””â”€Â workflows
â”‚Â Â Â Â Â â””â”€Â cicd.yml
â”œâ”€Â .gitignore
â”œâ”€Â Dockerfile
â”œâ”€Â LICENSE
â”œâ”€Â Makefile
â”œâ”€Â NBA_2015.db
â”œâ”€Â README.md
â”œâ”€Â data
â”‚Â Â â””â”€Â historical_projections.csv
â”œâ”€Â main.py
â”œâ”€Â mylib
â”‚Â Â â”œâ”€Â __init__.py
â”‚Â Â â”œâ”€Â extract.py
â”‚Â Â â”œâ”€Â query.py
â”‚Â Â â””â”€Â transform_load.py
â”œâ”€Â requirements.txt
â”œâ”€Â setup.sh
â””â”€Â test_main.py
```
Â©generated by [Project Tree Generator](https://woochanleee.github.io/project-tree-generator)


### Data:

historical_projections.csv contains historical results of the NBA draft projection model, 2001-2015.

The dataset contains the data behind the story [Projecting The Top 50 Players In The 2015 NBA Draft Class](http://fivethirtyeight.com/features/projecting-the-top-50-players-in-the-2015-nba-draft-class/). It can be accessed [here](https://github.com/fivethirtyeight/data/tree/master/nba-draft-2015)

### Steps:

1. Extract csv file from github link.

```
def extract(
    url="""https://github.com/fivethirtyeight/data/raw
    /refs/heads/master/nba-draft-2015/historical_projections.csv""",
    file_path="data/historical_projections.csv",
):
    """ "Extract a url to a file path"""
    with requests.get(url) as r:
        with open(file_path, "wb") as f:
            f.write(r.content)
    return file_path
```

2. From your csv file, transform and load the data into a SQLite3 database.

```
# load the csv file and insert into a new sqlite3 database
def load(dataset="data/historical_projections.csv"):
    """ "Transforms and Loads data into the local SQLite3 database"""

    # prints the full working directory and path
    print(os.getcwd())
    payload = csv.reader(open(dataset, newline=""), delimiter=",")
    next(payload)
    conn = sqlite3.connect("NBA_2015.db")
    c = conn.cursor()
    c.execute("DROP TABLE IF EXISTS NBA_2015")
    c.execute(
        """CREATE TABLE NBA_2015 (Player,Position,ID,Draft Year,
        Projected SPM,Superstar,Starter,Role Player,Bust)"""
    )
    # insert
    c.executemany(
        "INSERT INTO NBA_2015 VALUES (? ,?, ?, ?, ?, ?, ?, ?, ?)",
        payload,
    )
    conn.commit()
    conn.close()
    return "NBA_2015.db"
```

3. CRUD operations:

    a. Create Data

    Created a row of fake data for Lebron James
        ![create](images/create.png)

    b. Read Data

    Read all rows in dataset
        ![read](images/read.png)

    c. Update Data

    Update bust status if bust percentage above 50%
        ![update](images/update.png)

    d. Delete Data

    Delete all rows where position is center
        ![delete](images/delete.png)